# マスターコマンド: 既存アプリの機能再現と、GCPへの最適化を目的とした完全再設計

これより、あなたは私のプロジェクトの**リードアーキテクト兼シニア開発者**として、包括的な再設計タスクを開始します。

## 事前情報とあなたの役割

- **参考資料:** あなたは、以下の既存プロジェクトの全コードを、このタスクのコンテキストとして読み込んでいます。これはあくまで「実装すべき機能」の参考資料です。
  @C:\Users\sakurai.koki\OneDrive - 株式会社テクノスジャパン\デスクトップ\github\LLM-Playground

- **使用可能モデル(2025/7/9時点):**
  **Anthropic Claude シリーズ**
- Claude 3.7 Sonnet (2025年2月) - 最新・最高性能モデル（200K トークンコンテキスト、最大180K トークン出力）
- Claude 3.5 Sonnet (2024年10月) - 高知能バランス型
- Claude 3.5 Haiku (2024年10月) - 超高速・高知能
- Claude 3 Opus (2024年2月) - 複雑タスク対応最強モデル
- Claude 3 Sonnet (2024年2月) - バランス型
- Claude 3 Haiku (2024年3月) - 高速・軽量
 
**OpenAI GPT シリーズ**
- GPT-4o - 最新マルチモーダルモデル
- GPT-4o mini - 軽量・高速版
- GPT-3.5 Turbo - コスト効率重視
- O1 - 推論特化モデル
- O3-mini - 軽量推論モデル
 
**Geminiシリーズ**
- Gemini2.5pro
- Gemini2.5Flash
- Gemini1.5pro
- Gemini1.5Flash

- **私の役割:** 私はプロジェクトオーナーです。あなたは実装の途中で、特に**IP制限ロジック**や**各ファイルのアップロード処理**など、詳細な仕様が必要になった場合は、**私に相談してください。**その都度、参考となる既存コードを提示します。

### 1. 私の使命 (コアミッション)

私の第一かつ絶対の使命は、以下のコンテキストとして提供される既存アプリケーションが持つ**全ての機能を、一つ残らず完璧に再現する**ことです。
@C:\Users\sakurai.koki\OneDrive - 株式会社テクノスジャパン\デスクトップ\github\LLM-Playground

その上で、私の第二の使命は、デプロイの安定性と将来の拡張性を最大化するため、**技術選定を含めたアーキテクチャ全体をゼロから再設計し、より強力で洗練されたアプリケーションをこのディレクトリに構築する**ことです。

### 2. 私に与えられる権限 (技術選定の裁量)

あなたは私に、**最高のアプリケーションを構築するための完全な技術選定権限**を与えます。

- **フレームワーク & ライブラリ:** 既存の技術スタック（Vite, Wouterなど）に固執する必要はありません。デプロイの安定性、パフォーマンス、開発体験を考慮し、私が最適と判断するモダンなライブラリ（例: Next.js, Remix, Zustandなど）を積極的に採用します。
- **UI/UX:** 既存のUIの機能的なレイアウトは維持しつつ、shadcn/uiのポテンシャルを最大限に活かし、より洗練され、直感的なUI/UXへと改善する提案も行います。
- **依存関係:** 全てのパッケージと依存関係は、クリーンで競合のない、2025年7月現在のベストプラクティスに基づいた構成とします。

### 3. 設計上の絶対的な制約 (変更不可能な要件)

ただし、以下のアーキテクチャ上の制約は**必ず遵守**してください。

- **【除外事項】データベースは使用しません:**
    - 会話履歴やテンプレートの永続化は不要です。全てのデータはメモリ上でのみ管理してください。
- **【必須事項】ステートレスなファイルストレージ:**
    - ファイル管理は**Google Cloud Storage (GCS)** に全面的に移行します。バックエンドには、クライアントから直接アップロードするための**署名付きURL生成API**を実装してください。
- **【必須事項】IP制限ロジック:**
    - 既存のIP制限機能（`X-Forwarded-For`解析、特定IPリストとの照合等）は、ロジックを完全に維持したまま、新しいバックエンドのミドルウェアとして再実装してください。

### 4. 機能再現の契約書 (機能要件チェックリスト)

以下の機能リストが、新しいアプリケーションで100%動作することを保証してください。
- ✅ **全AIモデル対応** (Claude, GPT, Gemini)
- ✅ **マルチモーダル処理** (画像, PDF, DOCX, XLSX等)
- ✅ **大容量ファイル処理ロジック** (前後分割)
- ✅ **リアルタイムストリーミング** (WebSocket)

### 5. デプロイメント
- 最終的な成果物は、**GCP Cloud Run**へスムーズにデプロイできる、最適化された`Dockerfile`と`docker-compose.yml`（開発用）を必ず含んでください。

---

### 実行計画

以上の指示に基づき、まずは以下の内容を含む**「技術選定と設計提案書」**を提示してください。

1.  **推奨技術スタック:** フロントエンド、バックエンド、主要ライブラリの選定リストとその選定理由。（特に、過去に問題があったViteの代替案として何を推奨するか）
2.  **新しいプロジェクトのディレクトリ構造案。**
3.  **実装のステップ・バイ・ステップ計画。**

私がその提案を承認した後、実際のファイル生成を開始してください。